<!-- VIEW RESERVA-FORM
=============================================== -->
<p-dialog [(visible)]="state" closeOnEscape="true" closable="true" [modal]="true"
    styleClass="p-fluid dialog-responsive custom-header">

    <!-- HEADER -->
    <ng-template pTemplate="header">
        <div class="flex align-items-center w-full">
            <i class="pi pi-calendar-clock" style="font-size: 20px"></i>
            <span class="text-xl font-bold pl-3">Nueva Programación</span>
        </div>
    </ng-template>

    <!-- BODY -->
    <ng-template pTemplate="content">
        <div *ngIf="!reportPdf" class="card mt-5">
            <!-- CONSULTORIO -->
            <div class="grid">
                <div class="col-12 md:col-6">
                    <h3 *ngIf="option === 1" class="prefijoRow">Servicio de Consulta Externa</h3>
                    <h3 *ngIf="option === 2" class="prefijoRow">Servicio de Odontología</h3>
                    <h3 *ngIf="option === 3" class="prefijoRow">Servicio de Pediatria</h3>
                </div>
                <div class="col-12 md:col-6">
                    <div *ngIf="option === 1">
                        <span>Consultorio: </span><br>
                        {{consultorio?.descripcion}}
                    </div>
                    <div *ngIf="option === 2 || option === 3" class="field">
                        <label class="label-form" for="consultorioId">Consultorio:</label>
                        <p-dropdown [options]="consultorios" id="consultorioId" placeholder="Seleccione un Consultorio"
                            optionLabel="descripcion" [(ngModel)]="consultorio" (onChange)="getFichasDisponibles()"
                            class="w-full">
                        </p-dropdown>
                    </div>
                </div>
            </div>
            <hr class="mt-0">

            <div class="grid">
                <!-- PACIENTE -->
                <div class="col-12 sm:col-6">
                    <div class="field">
                        <label class="label-form" for="aseguradoId">Paciente:</label>
                        <p-dropdown [options]="beneficiarios" id="aseguradoId" placeholder="Seleccione Extensión"
                            optionLabel="paciente" [(ngModel)]="beneficiarioSelected" class="w-full">
                        </p-dropdown>
                    </div>
                </div>
                <!-- FECHA -->
                <div class="col-12 sm:col-6">
                    <div class="field">
                        <label class="label-form" for="fechaReserva">Fecha:</label>
                        <p-calendar dateFormat="dd-mm-yy" [showIcon]="true" [minDate]="minDate" [maxDate]="maxDate"
                            [(ngModel)]="fechaReserva" (onSelect)="getFichasDisponibles()" appendTo="body"
                            styleClass="calendar-small"></p-calendar>
                    </div>
                </div>
            </div>
            <hr>
            <div>
                <ng-container *ngFor="let medico of medicosByConsultorio">
                    <div class="grid card shadow-3" *ngIf="filterMedicos(medico)" style="background: #E6EBEA;">
                        <div class="col-12 sm:col-5">
                            <div class="text-center pt-3">
                                <img alt="foto" src="assets/images/img-medico.png"
                                    style="width: 40%; border-radius: 10%;" />
                                <div class="prefijoRow pt-3"><b>MÉDICO</b></div>
                                <div>{{medico.nombres}}</div>
                            </div>
                        </div>
                        <div class="col-12 sm:col-7">
                            <div *ngIf="medico.horasDisponibles?.length === 0" class="card text-center">
                                <i class="pi pi-exclamation-triangle" style="font-size: 50px"></i>
                                <h5>
                                    Señor asegurado, para esta fecha no se realizó
                                    ninguna programación.
                                </h5>
                            </div>
                            <ng-container *ngFor="let horaDisponible of medico.horasDisponibles">
                                <h5 class="pt-3">{{ horaDisponible.descripcion }}</h5>
                                <div class="flex flex-wrap gap-2 mt-2">
                                    <ng-container *ngFor="let hora of horaDisponible.horas">
                                        <!-- FICHA -->
                                        <button *ngIf="filterFichas(medico,hora)" type="button" class="hora-btn"
                                            (click)="!isReservada(horaDisponible,hora) ? showConfirmation(medico,horaDisponible,hora) : null"
                                            [ngClass]="{'reservado': isReservada(horaDisponible,hora),'disponible': !isReservada(horaDisponible,hora)}">
                                            {{ hora.inicioDetalle}} - {{ hora.finDetalle }} <br>
                                            <span *ngIf="isReservada(horaDisponible,hora)">Reservado</span>
                                            <span *ngIf="!isReservada(horaDisponible,hora)">Disponible</span>
                                        </button>
                                    </ng-container>
                                </div>
                            </ng-container>
                        </div>
                    </div>
                </ng-container>

                <ng-container *ngIf="(option == 2 || option == 3) && medicosByConsultorio.length == 0"
                    class="grid card shadow-3" style="background: #E6EBEA;">
                    <div class="card text-center w-full">
                        <i class="pi pi-exclamation-triangle" style="font-size: 50px"></i>
                        <h5>
                            Señor asegurado, selecciones un Consultorio..!!
                        </h5>
                    </div>
                </ng-container>
            </div>
        </div>

        <!-- REPORT PDF -->
        <ng-container *ngIf="reportPdf">
            <div class="card shadow-3 mt-5">
                <iframe [src]="reportPdf" width="100%" height="600px"></iframe>
            </div>
        </ng-container>
    </ng-template>

    <!--  FOOTER -->
    <ng-template pTemplate="footer">
        <hr class="w-full">
        <div class="flex justify-content-center gap-2">
            <p-button pRipple label="Cerrar" icon="pi pi-times" [text]="true" [raised]="true" severity="warning"
                (click)="close()" />
        </div>
    </ng-template>
</p-dialog>

<app-confirmation (response)="saveData()"></app-confirmation>
<app-alert></app-alert>
<p-toast></p-toast>